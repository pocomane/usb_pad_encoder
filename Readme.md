
# USB game-pad encoder with Arduino

This code let you to read various pad protocols and convert them to USB HID
events. It is focused on pads of old consoles like the SNES, and self-built
arcade sticks.

# Build an adaptor

The code supports the Arduino IDE, but it should be simple to port to other
platforms too. In particular, out of the box it is cofigured for a 'Arduino
Micro' board based on the 32u4.

You need to attach the board to the PC through the USB. Then you have to clone
this repository and use the Arduino IDE or `arduini-cli` to compile and flash
the code. Alternative you can simply launch the `build.sh` script that will
automate the steps. It uses `arduino-cli` that must be installed in the system.

Note: if you want use the Arduino IDE to compile the code, some version may
need the joystick library: https://github.com/MHeironimus/ArduinoJoystickLibrary .

By default all the supported protocols are enabled contemporary but all will be
seens as a single pad. So, you can connect multiple pad of different kind, but
the host will see the events coming from the same soruce.

Here there is the mapping you have to follow for every pad.

TODO : Draw schematics !

# Select the accepted protocols

You can disable or enable support for some protocol, by commenting or uncommenting
the definition of the following macro at the beginning of `usb_pad_encoder.h`. By
default they are all enabled, except the `ATARI_PADDLE` that is still in
development.

- `ENABLE_SNES` - To read NES or SNES pads
- `ENABLE_FULLSWITCH` - To read the controllers made fully of switches, like Atari 2600,
  Commodore, Amiga, JAMMA or self-built arcade sticks. Basically it supports a
  stick and 7 buttons.  Disabling ATARI_PADDLE other 2. ( TODO : increment button
  count also if SNES is disabled)
- `ATARI_PADDLE` - To read dual paddle controller for Atari 2600.

# Auto-fire

By default the auto-fire assist feature enabled. With a small change you can
turn it off or use a more classic auto-fire mode. The two modes supported are
the following.

In the ASSIST mode to start an autofire sequence you have to tap three time one
of the A/B/X/Y button and then hold it down. The auto-fire will continue until
you release the button.

In the TOGGLE mode, if you press and release SELECT while one of the A/B/X/Y
button is down it will enable and disable the auto-fire for that button.

To select the mode, You have just to set the `AUTOFIRE_MODE` macro at the
beginning of `usb_pad_encoder.h` to `NONE`, `ASSIST` or `TOGGLE`.

In the `NONE` mode, no auto-fire is generated, like the original SNES pad.

For all the other modes you can use the `AUTOFIRE_PERIOD` macro to change the
time between two taps generated by the auto-fire system.

If you selected the `ASSIST` mode, you can use the `TAP_MAX_PERIOD` macros to
set the maximum time between real taps to accept. Moreover, changing the
`AUTOFIRE_TAP_COUNT` macro you can set the number of consecutive taps to wait
before start the auto-fire sequence.

If you selected the `TOGGLE` mode, you can use the `AUTOFIRE_SELECTOR` to chage
the button to use as toggle in the `TOGGLE` mode (the default is `select`). Note
that some pad with few buttons (like the Atari one) can not use this mode.

# Configure Arduino USB name

TODO : update this section ! it is old! Now just need to update the `build.sh`

To change the name that arduino uses to identify itself on USB, you have to
change the `avr/boards.txt` file in the IDE setup folder. E.g., if you have an
Arduino Micro board:

```
...

## original ardunio USB VID/PID/Name
#micro.build.vid=0x2341
#micro.build.pid=0x8037
#micro.build.usb_product="Arduino Micro"

# Open source project USB VID - https://pid.codes/1209
# (test USB PID from 0x0000 to 0x010)
micro.build.vid=0x1209
micro.build.pid=0x0001
#micro.build.usb_product="Player 1 Input (arduino)"
micro.build.usb_product="SNES USB pad (arduino)"

...
```

This for example is usefull if you want to connect different kind of
arduino-powered to the same computer and have it to remember setups for each of
them.

# Code organization

TODO : exmplain Single File Library and Tests !

